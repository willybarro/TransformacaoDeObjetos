<!DOCTYPE HTML>
<html>
<head>
    <style>
        body {
            margin: 0px;
            padding: 0px;
        }
        #holder {
            margin: 0;
            float: left;
            width: 100px;
        }

        #myCanvas {
            float: left;
            border: 1px solid #ccc;
            margin-right: 10px;
        }
        #trans{
            margin-left: -100px;
            margin-top: 200px;
            float: left;
            width: 100px;
        }
    </style>
</head>
<body>
<canvas id="myCanvas" width="800" height="600"></canvas>
<div id="holder">
    <div>
        <label>x:</label><input type="text" id="x" />
        <label>y:</label><input type="text" id="y" />
        <label>tamanho:</label><input type="text" id="tamanho" />
    </div>

    <input type="submit" id="submitButton" onclick="submitFunction()" />
    <input type="button" id="cleanCanvas" onclick="cleanCanvas()" value="Limpar canvas"/>
</div>
<div id="trans">
    <div>
        <label>x:</label><input type="text" id="x_trans" />
        <label>y:</label><input type="text" id="y_trans" />
    </div>

    <input type="submit" onclick="submitTranslacao()" />
</div>
<script>
    var canvas = document.getElementById('myCanvas');
    var context = canvas.getContext('2d');
    var squareOriginal;

    function constructSquare(x, y, size) {
        var center = {x:x, y:y};
        x -= size/2;
        y -= size/2;
        var p1 = {x:x, y:y};
        var p2 = {x:x, y:y+size};
        var p3 = {x:x+size, y:y+size};
        var p4 = {x:x+size, y:y};

        return {p1:p1, p2:p2, p3:p3, p4:p4, center:center, size:size}
    }

    function position(x, y) {
        return {x:x, y:y}
    }

    function drawSquare(square, hexColor) {
        context.beginPath();
        context.moveTo(square.p1.x, square.p1.y);

        context.lineTo(square.p2.x, square.p2.y);
        context.lineTo(square.p3.x, square.p3.y);
        context.lineTo(square.p4.x, square.p4.y);
        context.lineTo(square.p1.x, square.p1.y);

        context.strokeStyle = hexColor;
        context.stroke();
    }

    // Retorna uma matriz
    function translacao(x, y, dx, dy) {
        var p = [[x,y,1]];

        var t = [[1,0,0],
                 [0,1,0],
                 [dx,dy,1]];
        var p_linha = multiplicaMatriz(p,t);
        return p_linha;
    }

    // Retorna uma matriz
    function rotacao(x, y, degrees) {
        var p = [[x, y, 1]];

        var r = [[Math.cos(degrees), Math.sin(degrees), 0],
             [-Math.sin(degrees), Math.cos(degrees), 0],
             [0,0,1]];

        var p_linha = multiplicaMatriz(p, r);
        return p_linha;
    }
//    //FUNCAO CAGADA
//    function rotacoes(degrees) {
//        var newPos = translacao(squareOriginal.center.x, squareOriginal.center.y, -squareOriginal.center.x, -squareOriginal.center.y)[0];
//        var newSquare = constructSquare(newPos[0], newPos[1], squareOriginal.size);
//        var p1_linha = rotacao(newSquare.p1.x, newSquare.p1.y, degrees)[0];
//        p1_linha = translacao(p1_linha[0], p1_linha[1], squareOriginal.center.x, squareOriginal.center.y)[0];
//        var p2_linha = rotacao(newSquare.p1.x, newSquare.p1.y, degrees)[0];
//        p2_linha = translacao(p2_linha[0], p2_linha[1], squareOriginal.center.x, squareOriginal.center.y)[0];
//        var p3_linha = rotacao(newSquare.p1.x, newSquare.p1.y, degrees)[0];
//        p3_linha = translacao(p3_linha[0], p3_linha[1], squareOriginal.center.x, squareOriginal.center.y)[0];
//        var p4_linha = rotacao(newSquare.p1.x, newSquare.p1.y, degrees)[0];
//        p4_linha = translacao(p4_linha[0], p4_linha[1], squareOriginal.center.x, squareOriginal.center.y)[0];
//        var p1 = {x:p1_linha[0], y:p1_linha[1]};
//        var p2 = {x:p2_linha[0], y:p2_linha[1]};
//        var p3 = {x:p3_linha[0], y:p3_linha[1]};
//        var p4 = {x:p4_linha[0], y:p4_linha[1]};
//        newSquare = {p1:p1, p2:p2, p3:p3, p4:p4};
//        drawSquare(newSquare, "#000000")
//
//    }

    // Retorna uma matriz
    function escala() {

    }

    // Retorna uma matriz
    function cisalhamento() {

    }

    // Retorna uma matriz
    function reflexao(x, y) {

    }

    function submitTranslacao() {
        var x = parseInt(document.getElementById('x_trans').value);
        var y = parseInt(document.getElementById('y_trans').value);
        var newPos = translacao(squareOriginal.center.x, squareOriginal.center.y, x, y);
        var newSquare = constructSquare(newPos[0][0], newPos[0][1], squareOriginal.size)
        drawSquare(newSquare, "#000000");
    }

    function submitFunction() {
        var x = parseInt(document.getElementById('x').value);
        var y = parseInt(document.getElementById('y').value);
        var size = parseInt(document.getElementById('tamanho').value);
        squareOriginal = constructSquare(x, y, size);
        drawSquare(squareOriginal, '#ff0000');
    }

    function cleanCanvas() {
        context.clearRect(0, 0, canvas.width, canvas.height);
    }
    
    function multiplicaMatriz(a, b) {
        var i, j, s, r, k;
        c = [];
        for (i = 0; i < a.length; i++) {
            r = [];
            for (j = 0; j < b[0].length; j++) {
                s = 0;
                for (k = 0; k < b.length; k++) {
                    s += a[i][k] * b[k][j];
                }
                r.push(s);
            }
            c.push(r);
        }
        return c;
    }


</script>
</body>
</html>