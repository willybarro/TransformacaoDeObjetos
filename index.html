<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <style>
        body {
            margin: 0;
            padding: 0;
        }
        #holder {
            margin: 0;
            float: left;
            width: 100px;
        }

        #myCanvas {
            float: left;
            border: 1px solid #ccc;
            margin-right: 10px;
        }
    </style>
</head>
<body>
<canvas id="myCanvas" width="800" height="600"></canvas>
<div id="holder">
    <div>
        <h3>Criar Quadrado:</h3>
        <label>x:</label><input type="text" id="x" />
        <label>y:</label><input type="text" id="y" />
        <label>tamanho:</label><input type="text" id="tamanho" />
        <input type="submit" id="submitButton" onclick="submitFunction()" />
        <input type="button" id="cleanCanvas" onclick="cleanCanvas()" value="Limpar canvas"/>
    </div>



    <div>
        <h3>Translação</h3>
        <label>x:</label><input type="text" id="x_trans" />
        <label>y:</label><input type="text" id="y_trans" />
        <input type="submit" onclick="submitTranslacao()" />
    </div>

    <div>
        <h3>Rotação</h3>
        <label>Graus:</label><input type="text" id="graus" />
        <input type="submit" onclick="submitRotacao();" />
    </div>

    <div>
        <h3>Escala</h3>
        <label>x:</label><input type="text" id="x_escala" />
        <label>y:</label><input type="text" id="y_escala" />
        <input type="submit" onclick="submitEscala();" />
    </div>

    <div>
        <h3>reflexao</h3>
        <label>x:</label><input type="checkbox" id="x_reflex"/>
        <label>y:</label><input type="checkbox"  id="y_reflex" />
        <input type="submit" onclick="submitReflexao();" />
    </div>

    <div>
        <h3>cisalhamento</h3>
        <label>x:</label><input type="text" />
        <label>y:</label><input type="text"  />
        <input type="submit" onclick="" />
    </div>

    <div>
        <h3>Commit</h3>
        <label>Hex Color:</label><input type="text" id="hexColor" />
        <input type="submit" onclick="commitChanges();">
    </div>
</div>


<script>
    var canvas = document.getElementById('myCanvas');
    var context = canvas.getContext('2d');
    var filaMatriz = [];
    var squareOriginal;
    
    window.onload = function () {
      desenhaQuadrantes();
    };
    
    function desenhaQuadrantes() {
        var y = canvas.width/2;
        var x = canvas.height/2;
        context.beginPath();
        context.moveTo(y, 0);
        context.lineTo(y, canvas.height);
        context.moveTo(0, x);
        context.lineTo(canvas.width, x);
        context.strokeStyle = "#000000";
        context.stroke();
    }

    function constructSquare(x, y, size) {
        var center = {x:x, y:y};
        x -= size/2;
        y -= size/2;
        var p1 = {x:x, y:y};
        var p2 = {x:x, y:y+size};
        var p3 = {x:x+size, y:y+size};
        var p4 = {x:x+size, y:y};

        return {p1:p1, p2:p2, p3:p3, p4:p4, center:center, size:size}
    }

    function drawSquare(square, hexColor) {
        context.beginPath();
        var width_to_zero = canvas.width/2;
        var height_to_zero = canvas.height/2;

        context.moveTo(square.p1.x + width_to_zero, square.p1.y + height_to_zero);

        context.lineTo(square.p2.x + width_to_zero, square.p2.y + height_to_zero);
        context.lineTo(square.p3.x + width_to_zero, square.p3.y + height_to_zero);
        context.lineTo(square.p4.x + width_to_zero, square.p4.y + height_to_zero);
        context.lineTo(square.p1.x + width_to_zero, square.p1.y + height_to_zero);

        context.strokeStyle = hexColor;
        context.stroke();
    }

    // Retorna uma matriz
    function translacao(dx, dy) {

        var matriz = [[1,0,0],
                 [0,1,0],
                 [dx,dy,1]];
        return matriz;
    }

    // Retorna uma matriz
    function rotacao(degrees) {
        var matriz = [[Math.cos(degrees), Math.sin(degrees), 0],
                      [-Math.sin(degrees), Math.cos(degrees), 0],
             [0,0,1]];

        return matriz;
    }

    // Retorna uma matriz
    function escala(sx, sy) {
        var matriz = [[sx,0,0],
                      [0,sy,0],
                      [0,0,1]];
        return matriz;
    }

    // Retorna uma matriz
    function cisalhamento() {

    }

    // Retorna uma matriz
    function reflexao(x, y) {
        if(x && y){
            var matriz = [[-1,0,0],
                          [0,-1,0],
                          [0,0,1]];
        }else if(x){
            var matriz = [[1,0,0],
                          [0,-1,0],
                          [0,0,1]];
        }else if(y){
            var matriz = [[-1,0,0],
                          [0,1,0],
                          [0,0,1]];
        }else {
            var matriz = [[1,0,0],
                          [0,1,0],
                          [0,0,1]];
        }

        return matriz;
    }

    function aplicaMatriz(square, matriz) {
        var p1_linha = multiplicaMatriz([[square.p1.x,square.p1.y,1]], matriz)[0];
        var p2_linha = multiplicaMatriz([[square.p2.x,square.p2.y,1]], matriz)[0];
        var p3_linha = multiplicaMatriz([[square.p3.x,square.p3.y,1]], matriz)[0];
        var p4_linha = multiplicaMatriz([[square.p4.x,square.p4.y,1]], matriz)[0];
        var newSquare = {
            p1:{x:p1_linha[0], y:p1_linha[1]},
            p2:{x:p2_linha[0], y:p2_linha[1]},
            p3:{x:p3_linha[0], y:p3_linha[1]},
            p4:{x:p4_linha[0], y:p4_linha[1]}
        };
        return newSquare;
    }

    function submitTranslacao() {
        var x = parseInt(document.getElementById('x_trans').value);
        var y = parseInt(document.getElementById('y_trans').value);
        filaMatriz.push(translacao(x, y));
    }

    function submitRotacao() {
        var graus = parseInt(document.getElementById('graus').value);
        filaMatriz.push(rotacao(graus));
    }

    function submitEscala(){
        var x = parseInt(document.getElementById('x_escala').value);
        var y = parseInt(document.getElementById('y_escala').value);
        filaMatriz.push(escala(x, y));
    }

    function submitReflexao(){
        var x = document.getElementById('x_reflex').checked;
        var y = document.getElementById('y_reflex').checked;
        filaMatriz.push(reflexao(x, y));
    }


    function submitFunction() {
        var x = parseInt(document.getElementById('x').value);
        var y = parseInt(document.getElementById('y').value);
        var size = parseInt(document.getElementById('tamanho').value);
        squareOriginal = constructSquare(x, y, size);
        drawSquare(squareOriginal, '#ff0000');
    }

    function commitChanges() {
        var color = document.getElementById('hexColor').value;
        var matriz = filaMatriz.shift();
        while (filaMatriz.length > 0){
            matriz = multiplicaMatriz(matriz, filaMatriz.shift());
        }
        var newSquare = aplicaMatriz(squareOriginal, matriz);
        drawSquare(newSquare, color);
    }

    function cleanCanvas() {
        context.clearRect(0, 0, canvas.width, canvas.height);
        desenhaQuadrantes();
        squareOriginal = '';
        filaMatriz = [];
    }
    
    function multiplicaMatriz(a, b) {
        var i, j, s, r, k;
        c = [];
        for (i = 0; i < a.length; i++) {
            r = [];
            for (j = 0; j < b[0].length; j++) {
                s = 0;
                for (k = 0; k < b.length; k++) {
                    s += a[i][k] * b[k][j];
                }
                r.push(s);
            }
            c.push(r);
        }
        return c;
    }


</script>
</body>
</html>